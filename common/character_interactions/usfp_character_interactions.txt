resign_from_office = {
	clicksound = "event:/SFX/UI/Military/command_grant"

	potential = {
		has_dlc_feature = voice_of_the_people_content
		owner ?= scope:actor
		is_ruler = yes
		is_immortal = no
		owner ?= {
			NOR = {
				has_law_or_variant = law_type:law_monarchy
				has_law_or_variant = law_type:law_theocracy
			}
		}
	}

	possible = {
		OR = {
			interest_group = {
				ig_approval <= angry
			}
			interest_group = {
				is_marginal = yes
			}
			popularity <= -50
			OR = {
				has_trait = psychological_affliction
				has_trait = cancer
				has_trait = senile
				has_trait = wounded
			}
			owner ?= {  # Our thanks to UHM for reporting this
				trigger_if = {
					limit = {
						any_political_movement = {
							is_insurrectionary = yes
							exists = most_desired_law
						}
					}
					any_political_movement = {
						is_insurrectionary = yes
						exists = most_desired_law
						most_desired_law ?= { save_temporary_scope_as = revolutionary_law }
						custom_tooltip = {
							text = ruler_disapproves_of_revolutionary_law
							root = {
								OR = {
									law_enactment_stance = {
										law = scope:revolutionary_law
										value < neutral
									}
									interest_group ?= {
										law_enactment_stance = {
											law = scope:revolutionary_law
											value < neutral
										}
									}
								}
							}
						}
					}
				}
				trigger_else = {
					AND = {
						any_political_movement = {
							is_insurrectionary = yes
						}
						custom_tooltip = {
							text = ruler_disapproves_of_revolutionary_law_contextless
							always = no
						}
					}
				}
			}
		}
		owner ?= { #USFP: No cheesing slavery
			NOR = {
				has_journal_entry = je_acw_countdown
				has_journal_entry = je_acw_war
			}
		}
	}

	effect = {
		if = {
			limit = {
				owner ?= {
					any_political_movement = {
						exists = most_desired_law
						is_insurrectionary = yes
					}
				}
			}
			owner ?= {
				trigger_event = { id = resignation.2 popup = yes }
			}
		}
		else = {
			owner ?= {
				trigger_event = { id = resignation.1 popup = yes }
			}
		}
	}

	cooldown = { months = 180 }
	show_confirmation_box = yes

	ai_chance = {
		value = -50
		if = {
			limit = {
				interest_group = {
					ig_approval <= angry
				}
			}
			add = 25
		}
		if = {
			limit = {
				interest_group = {
					is_marginal = yes
				}
			}
			add = 25
		}
		if = {
			limit = {
				popularity <= -50
			}
			add = 25
		}
		if = {
			limit = {
				popularity <= -75
			}
			add = 25
		}
		if = {
			limit = {
				OR = {
					has_trait = psychological_affliction
					has_trait = cancer
					has_trait = senile
					has_trait = wounded
				}
			}
			add = 25
		}
		if = {
			limit = {
				OR = {
					has_trait = arrogant
					has_trait = imperious
				}
			}
			add = -50
		}
	}
}

grant_leadership_to_agitator = {
	icon = "gfx/interface/character_panel/grant_command_not.dds"
	clicksound = "event:/SFX/DLC/1.3_ip1/UI/agitator_promote"

	potential = {
		has_dlc_feature = agitators
		has_role = agitator
		exists = owner
		owner ?= scope:actor
	}

	possible = {
		interest_group ?= {
			is_in_government = yes
		}
		trigger_if = {
			limit = {
				scope:actor ?= {
					AND = {
						has_law_or_variant = law_type:law_multicultural
						has_law_or_variant = law_type:law_total_separation
					}
				}
			}
			character_acceptance = { # In light of the Multiculturalism nerf
				target = scope:actor
				value >= acceptance_status_3
			}
		}
		trigger_else_if = {
			limit = { owner ?= { has_law_or_variant = law_type:law_state_atheism } }
			character_acceptance = {
				target = scope:actor
				value >= acceptance_status_4
			}
			NOR = {
				has_ideology = ideology:ideology_theocrat
				has_ideology = ideology:ideology_integralist
				has_ideology = ideology:ideology_traditionalist
				has_ideology = ideology:ideology_traditionalist_minoritarian
			}
		}
		trigger_else = {
			character_acceptance = {
				target = scope:actor
				value >= acceptance_status_4
			}
		}
		OR = {
			is_female = no
			scope:actor ?= { has_law_or_variant = law_type:law_womens_suffrage }
		}
		custom_tooltip = {
			text = grant_leadership_must_be_pressured_ig
			political_movement ?= {
				any_influenced_interest_group = {
					this = root.interest_group
				}
			}
		}
		owner ?= { in_election_campaign = no  } #USFP - natural citizen loophole
	}

	effect = {
		remove_character_role = agitator
		add_character_role = politician
		custom_tooltip = {
			text = make_agitator_ig_leader_tt
			set_as_interest_group_leader = yes
		}
	}

	cooldown = { days = normal_modifier_time }

	ai_chance = {
		value = -50
		if = {
			limit = {
				popularity > interest_group.leader.popularity
			}
			add = 25
		}
		if = {
			limit = {
				interest_group.leader.popularity <= -50
			}
			add = 50
		}
		if = {
			limit = {
				interest_group.leader.popularity >= 50
			}
			add = -50
		}
		if = {
			limit = {
				interest_group = {
					ig_approval <= 0
				}
			}
			add = 25
		}
		if = {
			limit = {
				this.ideology = owner.ruler.ideology
			}
			add = 50
		}
	}
}